{% extends 'layouts/layout-dashboard-user.html' %}

{% block header %}
{% block title %}Domótica - Usuario{% endblock %}
{% endblock %}

{% block content %}
<div>
    <!-- BEGIN: Breadcrumb -->
    <div class="mb-5">
        <ul class="m-0 p-0 list-none">
            <li
                class="inline-block relative top-[3px] text-base text-primary-500 font-Inter ">
                <a href="{{ url_for('home') }}">
                    <iconify-icon icon="heroicons-outline:home"></iconify-icon>
                    <iconify-icon icon="heroicons-outline:chevron-right"
                        class="relative text-slate-500 text-sm rtl:rotate-180">
                    </iconify-icon>
                </a>
            </li>
            <li
                class="inline-block relative text-sm text-primary-500 font-Inter ">
                Domótica
                <iconify-icon icon="heroicons-outline:chevron-right"
                    class="relative top-[3px] text-slate-500 rtl:rotate-180">
                </iconify-icon>
            </li>
            <li
                class="inline-block relative text-sm text-slate-500 font-Inter dark:text-white">
                Estadísticas
            </li>
        </ul>
    </div>
    <!-- END: BreadCrumb -->

    <div class="space-y-5">
        <div class="grid grid-cols-12 gap-5">
            <div class="lg:col-span-8 col-span-12 space-y-5">

                <!-- BEGIN: Line Chart -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">Consumo de energía (kwh)
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="consumo_energia" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Line Chart -->

                <!-- BEGIN: Line Chart -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">Consumo de agua (litros)
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="consumo_agua" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Line Chart -->

                <!-- BEGIN: Bar Chart -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">Uso de funcionalidades
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="chart1" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Bar Chart -->

                <!-- BEGIN: Horizontal Bar -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">La grafica 2
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="chartangel" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Horizontal Bar -->

                <!-- BEGIN: Bar Stacked -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">Bar Stacked
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="chart3" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Bar Stacked -->

                <!-- BEGIN: Radar Chart -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">Radar Chart
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="chart5" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Radar Chart -->

                <!-- BEGIN: Poller Area Chart -->
                <div class="card">
                    <header class=" card-header">
                        <h4 class="card-title">Poller Area Chart
                        </h4>
                    </header>
                    <div class="card-body px-6 pb-6">
                        <canvas id="chart6" class="h-[350px]"></canvas>
                    </div>
                </div>
                <!-- END: Poller Area Chart -->
            </div>
            <div class="lg:col-span-4 col-span-12 space-y-5">
                <div
                    class="grid md:grid-cols-12 sm:grid-cols-6 grid-cols-2 gap-3">

                    <!-- BEGIN: Group Chart5 -->

                    <div
                        class=" bg-info-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-50 text-center">
                        <div
                            class="text-info-500 mx-auto h-10 w-10 flex flex-col items-center justify-center rounded-full bg-white text-2xl mb-4">
                            <iconify-icon
                                icon=heroicons-outline:user-group></iconify-icon>
                        </div>
                        <span
                            class="block text-sm text-slate-600 font-medium dark:text-white mb-1">
                            Miembros
                        </span>
                        <span
                            class="block mb- text-2xl text-slate-900 dark:text-white font-medium">
                            {{ miembros }}
                        </span>
                    </div>

                    <div
                        class=" bg-warning-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-50 text-center">
                        <div
                            class="text-warning-500 mx-auto h-10 w-10 flex flex-col items-center justify-center rounded-full bg-white text-2xl mb-4">
                            <iconify-icon
                                icon=heroicons-outline:device-phone-mobile></iconify-icon>
                        </div>
                        <span
                            class="block text-sm text-slate-600 font-medium dark:text-white mb-1">
                            Dispositivos vinculados
                        </span>
                        <span
                            class="block mb- text-2xl text-slate-900 dark:text-white font-medium">
                            {{ dispositivos }}
                        </span>
                    </div>
                    <!-- END: Group Chart5 -->
                </div>
                <div class="grid md:grid-cols-12 sm:grid-cols-6 grid-cols-2 gap-3">

                    <!-- BEGIN: Group Chart4 -->

                    <div class="bg-warning-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-25 relative z-[1]" id="card1">
                        <div class="overlay absolute left-0 top-0 w-full h-full z-[-1]">
                            <img src="{{  url_for('static', filename='assets/images/all-img/shade-1.png') }}"
                                alt
                                draggable="false"
                                class="w-full h-full object-contain">
                        </div>
                        <div class="switch-button" onclick="switchCardContent('card1', 'card1Content1', 'card1Content2', this)"></div>
                        <div id="card1Content1">
                            <span class="block mb-6 text-sm text-slate-900 dark:text-white font-medium">
                                Consumo de luz
                            </span>
                            <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium mb-6">
                                354
                            </span>
                            <div class="flex space-x-2 rtl:space-x-reverse">
                                <div class="flex-none text-xl  text-primary-500">
                                    <iconify-icon
                                        icon="heroicons:arrow-trending-up"></iconify-icon>
                                </div>
                                <div class="flex-1 text-sm">
                                    <span class="block mb-[2px] text-primary-500">
                                        25.67%
                                    </span>
                                    <span class="block mb-1 text-slate-600 dark:text-slate-300">
                                        Desde el último mes
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div id="card1Content2" class="hidden">
                            HOLA
                        </div>
                    </div>

                    <div
                        class="bg-info-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-25 relative z-[1]">
                        <div
                            class="overlay absolute left-0 top-0 w-full h-full z-[-1]">
                            <img src="{{  url_for('static', filename='assets/images/all-img/shade-2.png') }}"
                                alt
                                draggable="false"
                                class="w-full h-full object-contain">
                        </div>
                        <span
                            class="block mb-6 text-sm text-slate-900 dark:text-white font-medium">
                            Consumo de agua
                        </span>
                        <span
                            class="block mb- text-2xl text-slate-900 dark:text-white font-medium mb-6">
                            $86,954
                        </span>
                        <div class="flex space-x-2 rtl:space-x-reverse">
                            <div class="flex-none text-xl  text-primary-500">
                                <iconify-icon
                                    icon="heroicons:arrow-trending-up"></iconify-icon>
                            </div>
                            <div class="flex-1 text-sm">
                                <span class="block mb-[2px] text-primary-500">
                                    8.67%
                                </span>
                                <span
                                    class="block mb-1 text-slate-600 dark:text-slate-300">
                                    Desde el último mes
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- END: Group Chart3 -->
                </div>
                <div class="card">
                    <header class="card-header">
                        <h4 class="card-title">Administración del hogar</h4>
                    </header>
                    <div class="card-body p-6">
                        <ul
                            class="divide-y divide-slate-100 dark:divide-slate-700">
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span></span>
                                    <span>-</span>
                                </div>
                            </li>
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span>Tipo de hogar</span>
                                    <span>Mediano</span>
                                </div>
                            </li>
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span>Tipo de membresía</span>
                                    <span> {{ paquete | capitalize }} </span>
                                </div>
                            </li>
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span>Tipo de suscripción</span>
                                    <span>Anual</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div
                    class="grid md:grid-cols-12 sm:grid-cols-6 grid-cols-1 gap-3">

                    <!-- BEGIN: Group Chart5 -->
                    <div
                        class=" bg-primary-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-50 text-center">
                        <div
                            class="text-primary-500 mx-auto h-10 w-10 flex flex-col items-center justify-center rounded-full bg-white text-2xl mb-4">
                            <iconify-icon
                                icon=heroicons-outline:shield-check></iconify-icon>
                        </div>
                        <span
                            class="block text-sm text-slate-600 font-medium dark:text-white mb-1">
                            Número de veces que se ha activado el modo seguro
                        </span>
                        <span
                            class="block mb- text-2xl text-slate-900 dark:text-white font-medium">
                            {{ modo_seguro }}
                        </span>
                    </div>

                    <!-- END: Group Chart5 -->
                </div>
                <div class="card">
                    <header class="card-header">
                        <h4 class="card-title">Dispositivos (tipos)</h4>
                    </header>
                    <div class="card-body p-6">
                        <div class="legend-ring3">
                            <div id="pie-chart-dispositivos"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    /* ChartJS */
    const isDark = localStorage.theme === "dark" ? true : false;
    const isRtl = localStorage.dir === "rtl" ? true : false;

    const colors = {
      primary: "#4669FA",
      secondary: "#A0AEC0",
      danger: "#F1595C",
      black: "#111112",
      warning: "#FA916B",
      info: "#0CE7FA",
      light: "#425466",
      success: "#50C793",
      "gray-f7": "#F7F8FC",
      dark: "#1E293B",
      "dark-gray": "#0F172A",
      gray: "#68768A",
      gray2: "#EEF1F9",
      "dark-light": "#CBD5E1",
    };
    
    const hexToRGB = (hex, alpha) => {
      var r = parseInt(hex.slice(1, 3), 16),
        g = parseInt(hex.slice(3, 5), 16),
        b = parseInt(hex.slice(5, 7), 16);
  
      if (alpha) {
        return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
      } else {
        return "rgb(" + r + ", " + g + ", " + b + ")";
      }
    };
    
    /* GRAFICA - CONSUMO DE ENERGIA (kwh) */
    const consumo_energia_2023 = {{ consumo_energia_2023 | tojson | safe }};
    const consumo_energia_2024 = {{ consumo_energia_2024 | tojson | safe }};
    const ctxConsumoEnergia = document.getElementById("consumo_energia");
    const lineChartConsumoEnergia = new Chart(ctxConsumoEnergia, {
        type: "line",
        data: {
          labels: [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',
          ],
          datasets: [
            {
              label: "Consumo 2023",
              data: consumo_energia_2023,
              fill: false,
              backgroundColor: hexToRGB(colors.primary, 1),
              borderColor: colors.primary,
              borderSkipped: "bottom",
              barThickness: 40,
              pointRadius: 1,
              pointHoverRadius: 5,
              pointHoverBorderWidth: 5,
              pointBorderColor: "transparent",
              lineTension: 0.5,
              pointStyle: "circle",
              pointShadowOffsetX: 1,
              pointShadowOffsetY: 1,
              pointShadowBlur: 5,
            },
            {
              label: "Consumo 2024",
              data: consumo_energia_2024,
              fill: false,
              backgroundColor: hexToRGB(colors.success, 1),
              borderColor: colors.success,
              borderSkipped: "bottom",
              barThickness: 40,
              pointRadius: 1,
              pointHoverRadius: 5,
              pointHoverBorderWidth: 5,
              pointBorderColor: "transparent",
              lineTension: 0.5,
              pointStyle: "circle",
              pointShadowOffsetX: 1,
              pointShadowOffsetY: 1,
              pointShadowBlur: 5,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: isDark ? "#cbd5e1" : "#475569",
              },
            },
          },
          scales: {
            y: {
              stacked: false,
              grid: {
                color: isDark ? "#334155" : "#e2e8f0",
              },
              ticks: {
                color: isDark ? "#cbd5e1" : "#475569",
              },
            },
            x: {
              grid: {
                color: isDark ? "#334155" : "#e2e8f0",
              },
  
              ticks: {
                color: isDark ? "#cbd5e1" : "#475569",
              },
            },
          },
        },
    });

    /* GRAFICA - CONSUMO DE AGUA (litros) */
    const consumo_agua_2023 = {{ consumo_agua_2023 | tojson | safe }};
    const consumo_agua_2024 = {{ consumo_agua_2024 | tojson | safe }};
    const ctxConsumoAgua = document.getElementById("consumo_agua");
    const lineChartConsumoAgua = new Chart(ctxConsumoAgua, {
        type: "line",
        data: {
          labels: [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',
          ],
          datasets: [
            {
              label: "Consumo 2023",
              data: consumo_agua_2023,
              fill: false,
              backgroundColor: hexToRGB(colors.primary, 1),
              borderColor: colors.primary,
              borderSkipped: "bottom",
              barThickness: 40,
              pointRadius: 1,
              pointHoverRadius: 5,
              pointHoverBorderWidth: 5,
              pointBorderColor: "transparent",
              lineTension: 0.5,
              pointStyle: "circle",
              pointShadowOffsetX: 1,
              pointShadowOffsetY: 1,
              pointShadowBlur: 5,
            },
            {
              label: "Consumo 2024",
              data: consumo_agua_2024,
              fill: false,
              backgroundColor: hexToRGB(colors.success, 1),
              borderColor: colors.success,
              borderSkipped: "bottom",
              barThickness: 40,
              pointRadius: 1,
              pointHoverRadius: 5,
              pointHoverBorderWidth: 5,
              pointBorderColor: "transparent",
              lineTension: 0.5,
              pointStyle: "circle",
              pointShadowOffsetX: 1,
              pointShadowOffsetY: 1,
              pointShadowBlur: 5,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: isDark ? "#cbd5e1" : "#475569",
              },
            },
          },
          scales: {
            y: {
              stacked: false,
              grid: {
                color: isDark ? "#334155" : "#e2e8f0",
              },
              ticks: {
                color: isDark ? "#cbd5e1" : "#475569",
              },
            },
            x: {
              grid: {
                color: isDark ? "#334155" : "#e2e8f0",
              },
  
              ticks: {
                color: isDark ? "#cbd5e1" : "#475569",
              },
            },
          },
        },
    });
</script>

<script>
    const apexChartDispositivoOptions = {
        chart: {
            height: 335,
            type: "pie",
            toolbar: {
              show: false,
            },
        },
        labels: {{ dispositivos_tipos | tojson | safe }},
        dataLabels: {
            enabled: true,
        },
        colors: [colors.success, colors.warning, "#A3A1FB"],
        series: {{ dispositivos_cantidades | tojson | safe }},
        legend: {
            position: "bottom",
            fontSize: "12px",
            fontFamily: "Inter",
            fontWeight: 400,
            labels: {
              colors: isDark ? "#CBD5E1" : "#475569",
            },
            markers: {
              width: 6,
              height: 6,
              offsetY: -1,
              offsetX: -5,
              radius: 12,
            },
            itemMargin: {
              horizontal: 10,
              vertical: 0,
            },
        },
        responsive: [
            {
                breakpoint: 480,
                options: {
                    legend: {
                        position: "bottom",
                    },
                },
            },
        ],
    };

    const ctxDispositivo = new ApexCharts(document.querySelector("#pie-chart-dispositivos"), apexChartDispositivoOptions);
    ctxDispositivo.render();
</script>

<script>
    function switchCardContent(cardId, contentId1, contentId2, switchButton) {
        const content1 = document.getElementById(contentId1);
        const content2 = document.getElementById(contentId2);

        if (content1.classList.contains('hidden')) {
            content1.classList.remove('hidden');
            content2.classList.add('hidden');
            switchButton.classList.remove('outline');
        } else {
            content1.classList.add('hidden');
            content2.classList.remove('hidden');
            switchButton.classList.add('outline');
        }
    }
</script>
{% endblock %}