{% extends 'layouts/layout-dashboard-user.html' %}

{% block header %}
{% block title %}Domótica - Usuario{% endblock %}
{% endblock %}

{% block content %}
<div>
    <!-- BEGIN: Breadcrumb -->
    <div class="mb-5">
        <ul class="m-0 p-0 list-none">
            <li class="inline-block relative top-[3px] text-base text-primary-500 font-Inter ">
                <a href="{{ url_for('home') }}">
                    <iconify-icon icon="heroicons-outline:home"></iconify-icon>
                    <iconify-icon icon="heroicons-outline:chevron-right"
                        class="relative text-slate-500 text-sm rtl:rotate-180">
                    </iconify-icon>
                </a>
            </li>
            <li class="inline-block relative text-sm text-primary-500 font-Inter ">
                Domótica
                <iconify-icon icon="heroicons-outline:chevron-right"
                    class="relative top-[3px] text-slate-500 rtl:rotate-180">
                </iconify-icon>
            </li>
            <li class="inline-block relative text-sm text-slate-500 font-Inter dark:text-white">
                Estadísticas
            </li>
        </ul>
    </div>
    <!-- END: BreadCrumb -->

    <div class="space-y-5">
        <div class="grid grid-cols-12 gap-5">
            <div class="lg:col-span-8 col-span-12 space-y-5">

                <!-- BEGIN: Line Chart - Energía -->
                <div class="card">
                    <div class="card-body flex flex-col p-6">
                        <header
                            class="flex mb-5 items-center border-b border-slate-100 dark:border-slate-700 pb-5 -mx-6 px-6">
                            <div class="flex-1">
                                <div id="tab-title-energia" class="card-title text-slate-900 dark:text-white">Consumo de energía (kwh)</div>
                            </div>
                        </header>
                        <div class="card-text h-full ">
                            <div>
                                <ul class="nav nav-tabs flex justify-around flex-col md:flex-row flex-wrap list-none border-b-0 pl-0 mb-4"
                                    id="tabs-tab" role="tablist">
                                    <li class="nav-item flex-grow" role="presentation">
                                        <a href="#tabs-energia-kwh"
                                            class="nav-link w-full block font-medium text-sm font-Inter leading-tight border-x-0 border-t-0 border-b border-transparent px-4 pb-2 my-2 hover:border-transparent focus:border-transparent active dark:text-slate-300 text-center"
                                            id="tabs-energia-kwh-tab" data-bs-toggle="pill"
                                            data-bs-target="#tabs-energia-kwh" role="tab"
                                            aria-controls="tabs-energia-kwh" aria-selected="true">
                                            <iconify-icon class="mr-1 text-base align-middle mb-1" icon="heroicons-outline:light-bulb"></iconify-icon>kwh
                                        </a>
                                    </li>
                                    <li class="nav-item flex-grow" role="presentation">
                                        <a href="#tabs-energia-mxn"
                                            class="nav-link w-full block font-medium text-sm font-Inter leading-tight capitalize border-x-0 border-t-0 border-b border-transparent px-4 pb-2 my-2 hover:border-transparent focus:border-transparent dark:text-slate-300 text-center"
                                            id="tabs-energia-mxn-tab" data-bs-toggle="pill"
                                            data-bs-target="#tabs-energia-mxn" role="tab"
                                            aria-controls="tabs-energia-mxn" aria-selected="false">
                                            <iconify-icon class="mr-1 text-base align-middle mb-1" icon="heroicons-outline:currency-dollar"></iconify-icon>MXN
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content" id="tabs-tabContent">
                                    <div class="tab-pane fade show active" id="tabs-energia-kwh" role="tabpanel"
                                        aria-labelledby="tabs-energia-kwh-tab">
                                        <canvas id="consumo_energia_kwh" class="h-[350px]"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="tabs-energia-mxn" role="tabpanel"
                                        aria-labelledby="tabs-energia-mxn-tab">
                                        <canvas id="consumo_energia_mxn" class="h-[350px]"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END: Line Chart - Energía -->

                <!-- BEGIN: Line Chart - Agua -->
                <div class="card">
                    <div class="card-body flex flex-col p-6">
                        <header
                            class="flex mb-5 items-center border-b border-slate-100 dark:border-slate-700 pb-5 -mx-6 px-6">
                            <div class="flex-1">
                                <div id="tab-title-agua" class="card-title text-slate-900 dark:text-white">Consumo de agua (Litros)</div>
                            </div>
                        </header>
                        <div class="card-text h-full ">
                            <div>
                                <ul class="nav nav-tabs flex justify-around flex-col md:flex-row flex-wrap list-none border-b-0 pl-0 mb-4"
                                    id="tabs-tab" role="tablist">
                                    <li class="nav-item flex-grow" role="presentation">
                                        <a href="#tabs-agua-litros"
                                            class="nav-link w-full block font-medium text-sm font-Inter leading-tight border-x-0 border-t-0 border-b border-transparent px-4 pb-2 my-2 hover:border-transparent focus:border-transparent active dark:text-slate-300 text-center"
                                            id="tabs-agua-litros-tab" data-bs-toggle="pill"
                                            data-bs-target="#tabs-agua-litros" role="tab"
                                            aria-controls="tabs-agua-litros" aria-selected="true">
                                            <iconify-icon class="mr-1 text-base align-middle mb-1" icon="heroicons-outline:beaker"></iconify-icon>Litros
                                        </a>
                                    </li>
                                    <li class="nav-item flex-grow" role="presentation">
                                        <a href="#tabs-agua-mxn"
                                            class="nav-link w-full block font-medium text-sm font-Inter leading-tight capitalize border-x-0 border-t-0 border-b border-transparent px-4 pb-2 my-2 hover:border-transparent focus:border-transparent dark:text-slate-300 text-center"
                                            id="tabs-agua-mxn-tab" data-bs-toggle="pill"
                                            data-bs-target="#tabs-agua-mxn" role="tab"
                                            aria-controls="tabs-agua-mxn" aria-selected="false">
                                            <iconify-icon class="mr-1 text-base align-middle mb-1" icon="heroicons-outline:currency-dollar"></iconify-icon>MXN
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content" id="tabs-tabContent">
                                    <div class="tab-pane fade show active" id="tabs-agua-litros" role="tabpanel"
                                        aria-labelledby="tabs-agua-litros-tab">
                                        <canvas id="consumo_agua_litros" class="h-[350px]"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="tabs-agua-mxn" role="tabpanel"
                                        aria-labelledby="tabs-agua-mxn-tab">
                                        <canvas id="consumo_agua_mxn" class="h-[350px]"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END: Line Chart - Agua -->

            </div>
            <div class="lg:col-span-4 col-span-12 space-y-5">
                <div class="grid md:grid-cols-12 sm:grid-cols-6 grid-cols-2 gap-3">

                    <!-- BEGIN: Group Chart5 -->

                    <div class=" bg-info-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-50 text-center">
                        <div
                            class="text-info-500 mx-auto h-10 w-10 flex flex-col items-center justify-center rounded-full bg-white text-2xl mb-4">
                            <iconify-icon icon=heroicons-outline:user-group></iconify-icon>
                        </div>
                        <span class="block text-sm text-slate-600 font-medium dark:text-white mb-1">
                            Miembros
                        </span>
                        <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium">
                            {{ miembros }}
                        </span>
                    </div>

                    <div class=" bg-warning-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-50 text-center">
                        <div
                            class="text-warning-500 mx-auto h-10 w-10 flex flex-col items-center justify-center rounded-full bg-white text-2xl mb-4">
                            <iconify-icon icon=heroicons-outline:device-phone-mobile></iconify-icon>
                        </div>
                        <span class="block text-sm text-slate-600 font-medium dark:text-white mb-1">
                            Dispositivos vinculados
                        </span>
                        <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium">
                            {{ dispositivos }}
                        </span>
                    </div>
                    <!-- END: Group Chart5 -->
                </div>
                <div class="grid md:grid-cols-12 sm:grid-cols-6 grid-cols-2 gap-3">

                    <!-- BEGIN: Group Chart4 -->

                    <div class="bg-warning-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-25 relative z-[1]"
                        id="card1">
                        <div class="overlay absolute left-0 top-0 w-full h-full z-[-1]">
                            <img src="{{  url_for('static', filename='assets/images/all-img/shade-1.png') }}" alt
                                draggable="false" class="w-full h-full object-contain">
                        </div>
                        <div class="switch-button"
                            onclick="switchCardContent('card1', 'card1Content1', 'card1Content2', this)"></div>
                        <div id="card1Content1">
                            <span class="block mb-6 text-sm text-slate-900 dark:text-white font-medium">
                                Consumo de luz - kwh (más reciente)
                            </span>
                            <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium mb-6">
                                {{ consumo_actual_kwh }} kwh
                            </span>
                            <div class="flex space-x-2 rtl:space-x-reverse">
                                <div class="flex-none text-xl text-primary-500">
                                    {% if diferencia_porcentual_kwh and diferencia_porcentual_kwh.positivo %}
                                        <iconify-icon icon="heroicons:arrow-trending-up"></iconify-icon>
                                    {% else %}
                                        <iconify-icon icon="heroicons:arrow-trending-down"></iconify-icon>
                                    {% endif %}
                                </div>
                                <div class="flex-1 text-sm">
                                    <span class="block mb-[2px] text-primary-500">
                                        {{ cambio_porcentual_kwh }}%
                                    </span>
                                    <span class="block mb-1 text-slate-600 dark:text-slate-300">
                                        Desde el último mes ({{ inicio_anterior_kwh_formateado | capitalize }})
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div id="card1Content2" class="hidden">
                            <span class="block mb-6 text-sm text-slate-900 dark:text-white font-medium">
                                Consumo de luz - MXN (más reciente)
                            </span>
                            <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium mb-6">
                                ${{ consumo_actual_energia_mxn }}
                            </span>
                            <div class="flex space-x-2 rtl:space-x-reverse">
                                <div class="flex-none text-xl  text-primary-500">
                                    {% if diferencia_porcentual_energia_mxn and diferencia_porcentual_energia_mxn.positivo %}
                                        <iconify-icon icon="heroicons:arrow-trending-up"></iconify-icon>
                                    {% else %}
                                        <iconify-icon icon="heroicons:arrow-trending-down"></iconify-icon>
                                    {% endif %}
                                </div>
                                <div class="flex-1 text-sm">
                                    <span class="block mb-[2px] text-primary-500">
                                        {{ cambio_porcentual_energia_mxn }}%
                                    </span>
                                    <span class="block mb-1 text-slate-600 dark:text-slate-300">
                                        Desde el último mes ({{ inicio_anterior_kwh_formateado | capitalize }})
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-info-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-25 relative z-[1]">
                        <div class="overlay absolute left-0 top-0 w-full h-full z-[-1]">
                            <img src="{{  url_for('static', filename='assets/images/all-img/shade-2.png') }}" alt
                                draggable="false" class="w-full h-full object-contain">
                        </div>
                        <span class="block mb-6 text-sm text-slate-900 dark:text-white font-medium">
                            Consumo de agua
                        </span>
                        <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium mb-6">
                            $86,954
                        </span>
                        <div class="flex space-x-2 rtl:space-x-reverse">
                            <div class="flex-none text-xl  text-primary-500">
                                <iconify-icon icon="heroicons:arrow-trending-up"></iconify-icon>
                            </div>
                            <div class="flex-1 text-sm">
                                <span class="block mb-[2px] text-primary-500">
                                    8.67%
                                </span>
                                <span class="block mb-1 text-slate-600 dark:text-slate-300">
                                    Desde el último mes
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- END: Group Chart3 -->
                </div>
                <div class="card">
                    <header class="card-header">
                        <h4 class="card-title">Administración del hogar</h4>
                    </header>
                    <div class="card-body p-6">
                        <ul class="divide-y divide-slate-100 dark:divide-slate-700">
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span></span>
                                    <span>-</span>
                                </div>
                            </li>
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span>Tipo de hogar</span>
                                    <span>Mediano</span>
                                </div>
                            </li>
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span>Tipo de membresía</span>
                                    <span> {{ paquete | capitalize }} </span>
                                </div>
                            </li>
                            <li
                                class="first:text-xs text-sm first:text-slate-600 text-slate-600 dark:text-slate-300 py-2 first:uppercase">
                                <div class="flex justify-between">
                                    <span>Tipo de suscripción</span>
                                    <span>Anual</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="grid md:grid-cols-12 sm:grid-cols-6 grid-cols-1 gap-3">

                    <!-- BEGIN: Group Chart5 -->
                    <div class=" bg-primary-500 rounded-md p-4 bg-opacity-[0.15] dark:bg-opacity-50 text-center">
                        <div
                            class="text-primary-500 mx-auto h-10 w-10 flex flex-col items-center justify-center rounded-full bg-white text-2xl mb-4">
                            <iconify-icon icon=heroicons-outline:shield-check></iconify-icon>
                        </div>
                        <span class="block text-sm text-slate-600 font-medium dark:text-white mb-1">
                            Número de veces que se ha activado el modo seguro
                        </span>
                        <span class="block mb- text-2xl text-slate-900 dark:text-white font-medium">
                            {{ modo_seguro }}
                        </span>
                    </div>

                    <!-- END: Group Chart5 -->
                </div>
                <div class="card">
                    <header class="card-header">
                        <h4 class="card-title">Dispositivos (tipos)</h4>
                    </header>
                    <div class="card-body p-6">
                        <div class="legend-ring3">
                            <div id="pie-chart-dispositivos"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    /* ChartJS */
    const isDark = localStorage.theme === "dark" ? true : false;
    const isRtl = localStorage.dir === "rtl" ? true : false;

    const colors = {
        primary: "#4669FA",
        secondary: "#A0AEC0",
        danger: "#F1595C",
        black: "#111112",
        warning: "#FA916B",
        info: "#0CE7FA",
        light: "#425466",
        success: "#50C793",
        "gray-f7": "#F7F8FC",
        dark: "#1E293B",
        "dark-gray": "#0F172A",
        gray: "#68768A",
        gray2: "#EEF1F9",
        "dark-light": "#CBD5E1",
    };

    const hexToRGB = (hex, alpha) => {
        var r = parseInt(hex.slice(1, 3), 16),
            g = parseInt(hex.slice(3, 5), 16),
            b = parseInt(hex.slice(5, 7), 16);

        if (alpha) {
            return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
        } else {
            return "rgb(" + r + ", " + g + ", " + b + ")";
        }
    };

    /* GRAFICA - CONSUMO DE ENERGIA (kwh) */
    const consumo_energia_kwh_2023 = {{ consumo_energia_kwh_2023 | tojson | safe }};
    const consumo_energia_kwh_2024 = {{ consumo_energia_kwh_2024 | tojson | safe }};
    const ctxConsumoEnergiaKwh = document.getElementById("consumo_energia_kwh");
    const lineChartConsumoEnergiaKwh = new Chart(ctxConsumoEnergiaKwh, {
        type: "line",
        data: {
            labels: [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',
            ],
            datasets: [
                {
                    label: "Consumo 2023",
                    data: consumo_energia_kwh_2023,
                    fill: false,
                    backgroundColor: hexToRGB(colors.primary, 1),
                    borderColor: colors.primary,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
                {
                    label: "Consumo 2024",
                    data: consumo_energia_kwh_2024,
                    fill: false,
                    backgroundColor: hexToRGB(colors.success, 1),
                    borderColor: colors.success,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
            ],
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.dataset.label || '';
                            if (label) {
                                return `${label}: ${context.parsed.y} kwh`;
                            }
                            return `${context.parsed.y} kwh`;
                        },
                    },
                },
            },
            scales: {
                y: {
                    stacked: false,
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },
                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                        callback: function(value, index, values) {
                            return value + ' kwh';
                        },
                    },
                },
                x: {
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },

                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
            },
        },
    });

    /* GRAFICA - CONSUMO DE ENERGIA (MXN) */
    const consumo_energia_mxn_2023 = {{ consumo_energia_mxn_2023 | tojson | safe }};
    const consumo_energia_mxn_2024 = {{ consumo_energia_mxn_2024 | tojson | safe }};
    const ctxConsumoEnergiaMxn = document.getElementById("consumo_energia_mxn");
    const lineChartConsumoEnergiaMxn = new Chart(ctxConsumoEnergiaMxn, {
        type: "line",
        data: {
            labels: [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',
            ],
            datasets: [
                {
                    label: "Consumo 2023",
                    data: consumo_energia_mxn_2023,
                    fill: false,
                    backgroundColor: hexToRGB(colors.primary, 1),
                    borderColor: colors.primary,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
                {
                    label: "Consumo 2024",
                    data: consumo_energia_mxn_2024,
                    fill: false,
                    backgroundColor: hexToRGB(colors.success, 1),
                    borderColor: colors.success,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
            ],
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '$' + context.raw.toFixed(2);
                        },
                    },
                },
            },
            scales: {
                y: {
                    stacked: false,
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },
                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                        callback: function(value, index, values) {
                            return '$' + value;
                        },
                    },
                },
                x: {
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },

                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
            },
        },
    });

    /* GRAFICA - CONSUMO DE AGUA (litros) */
    const consumo_agua_litros_2023 = {{ consumo_agua_litros_2023 | tojson | safe }};
    const consumo_agua_litros_2024 = {{ consumo_agua_litros_2024 | tojson | safe }};
    const ctxConsumoAguaLitros = document.getElementById("consumo_agua_litros");
    const lineChartConsumoAguaLitros = new Chart(ctxConsumoAguaLitros, {
        type: "line",
        data: {
            labels: [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',
            ],
            datasets: [
                {
                    label: "Consumo 2023",
                    data: consumo_agua_litros_2023,
                    fill: false,
                    backgroundColor: hexToRGB(colors.primary, 1),
                    borderColor: colors.primary,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
                {
                    label: "Consumo 2024",
                    data: consumo_agua_litros_2024,
                    fill: false,
                    backgroundColor: hexToRGB(colors.success, 1),
                    borderColor: colors.success,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
            ],
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.dataset.label || '';
                            if (label) {
                                return `${label}: ${context.parsed.y} L`;
                            }
                            return `${context.parsed.y} L`;
                        },
                    },
                },
            },
            scales: {
                y: {
                    stacked: false,
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },
                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                        callback: function(value, index, values) {
                            return value + ' L';
                        },
                    },
                },
                x: {
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },

                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
            },
        },
    });

    /* GRAFICA - CONSUMO DE AGUA (MXN) */
    const consumo_agua_mxn_2023 = {{ consumo_agua_mxn_2023 | tojson | safe }};
    const consumo_agua_mxn_2024 = {{ consumo_agua_mxn_2024 | tojson | safe }};
    const ctxConsumoAguaMxn = document.getElementById("consumo_agua_mxn");
    const lineChartConsumoAguaMxn = new Chart(ctxConsumoAguaMxn, {
        type: "line",
        data: {
            labels: [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',
            ],
            datasets: [
                {
                    label: "Consumo 2023",
                    data: consumo_agua_mxn_2023,
                    fill: false,
                    backgroundColor: hexToRGB(colors.primary, 1),
                    borderColor: colors.primary,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
                {
                    label: "Consumo 2024",
                    data: consumo_agua_mxn_2024,
                    fill: false,
                    backgroundColor: hexToRGB(colors.success, 1),
                    borderColor: colors.success,
                    borderSkipped: "bottom",
                    barThickness: 40,
                    pointRadius: 1,
                    pointHoverRadius: 5,
                    pointHoverBorderWidth: 5,
                    pointBorderColor: "transparent",
                    lineTension: 0.2,
                    pointStyle: "circle",
                    pointShadowOffsetX: 1,
                    pointShadowOffsetY: 1,
                    pointShadowBlur: 5,
                },
            ],
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '$' + context.raw.toFixed(2);
                        },
                    },
                },
            },
            scales: {
                y: {
                    stacked: false,
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },
                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                        callback: function(value, index, values) {
                            return '$' + value;
                        },
                    },
                },
                x: {
                    grid: {
                        color: isDark ? "#334155" : "#e2e8f0",
                    },

                    ticks: {
                        color: isDark ? "#cbd5e1" : "#475569",
                    },
                },
            },
        },
    });
</script>

<script>
    const apexChartDispositivoOptions = {
        chart: {
            height: 335,
            type: "pie",
            toolbar: {
                show: false,
            },
        },
        labels: {{ dispositivos_tipos | tojson | safe }},
        dataLabels: {
            enabled: true,
        },
        colors: [colors.success, colors.warning, "#A3A1FB"],
        series: {{ dispositivos_cantidades | tojson | safe }},
        legend: {
            position: "bottom",
            fontSize: "12px",
            fontFamily: "Inter",
            fontWeight: 400,
            labels: {
                colors: isDark ? "#CBD5E1" : "#475569",
            },
            markers: {
                width: 6,
                height: 6,
                offsetY: -1,
                offsetX: -5,
                radius: 12,
            },
            itemMargin: {
                horizontal: 10,
                vertical: 0,
            },
        },
        responsive: [
            {
                breakpoint: 480,
                options: {
                    legend: {
                        position: "bottom",
                    },
                },
            },
        ],
    };

    const ctxDispositivo = new ApexCharts(document.querySelector("#pie-chart-dispositivos"), apexChartDispositivoOptions);
    ctxDispositivo.render();
</script>

<script>
    function switchCardContent(cardId, contentId1, contentId2, switchButton) {
        const content1 = document.getElementById(contentId1);
        const content2 = document.getElementById(contentId2);

        if (content1.classList.contains('hidden')) {
            content1.classList.remove('hidden');
            content2.classList.add('hidden');
            switchButton.classList.remove('outline');
        } else {
            content1.classList.add('hidden');
            content2.classList.remove('hidden');
            switchButton.classList.add('outline');
        }
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('[data-bs-toggle="pill"]');
        const titleMap = {
            'tabs-energia-kwh': 'Consumo de energía (kwh)',
            'tabs-energia-mxn': 'Consumo de energía (MXN)',
            'tabs-agua-litros': 'Consumo de agua (Litros)',
            'tabs-agua-mxn': 'Consumo de agua (MXN)',
        };

        tabs.forEach(tab => {
            tab.addEventListener('shown.bs.tab', function (event) {
                const href = event.target.getAttribute('href').substring(1); // Remove leading '#'
                const titleElement = document.querySelector(`[id^="tab-title-"][id$="${href.split('-')[1]}"]`);
                
                if (titleElement && titleMap[href]) {
                    titleElement.textContent = titleMap[href];
                }
            });
        });
    });
</script>
{% endblock %}